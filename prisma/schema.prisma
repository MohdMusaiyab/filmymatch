generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String              @id @default(cuid())
  email              String              @unique
  password           String
  username           String              @unique
  bio                String?
  phone              String?
  avatar             String?
  emailVerified      Boolean             @default(false)
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  collections        Collection[]
  comments           Comment[]
  followers          Follow[]            @relation("Follower")
  followings         Follow[]            @relation("Following")
  highlightedPosts   HighlightedPost[]   @relation("HighlightedPosts")
  likes              Like[]
  posts              Post[]
  savedPosts         SavedPost[]         @relation("SavedPosts")
  verificationTokens VerificationToken[]
}

model SavedPost {
  id        String   @id @default(cuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation("SavedPosts", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
}

model HighlightedPost {
  id        String   @id @default(cuid())
  postId    String
  userId    String
  notes     String?
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation("HighlightedPosts", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
}

model VerificationToken {
  id        String   @id @default(cuid())
  token     String   @unique
  expiresAt DateTime
  userId    String
  purpose   String   @default("email_verification")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

model Post {
  id            String            @id @default(cuid())
  title         String
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  category      Category
  coverImage    String?
  description   String
  isDraft       Boolean           @default(false)
  tags          TAGS[]
  userId        String
  visibility    Visibility        @default(PRIVATE)
  comments      Comment[]
  highlightedBy HighlightedPost[]
  images        Image[]
  likes         Like[]
  user          User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  savedBy       SavedPost[]
  collections   Collection[]      @relation("PostsInCollections")

  @@index([userId])
  @@index([visibility])
  @@index([category])
  @@index([isDraft])
  @@index([createdAt])
  @@index([visibility, isDraft])
  @@index([category, visibility, isDraft])
  @@index([userId, createdAt])
  @@index([visibility, createdAt])
}

model Collection {
  id          String     @id @default(cuid())
  name        String
  description String?
  coverImage  String?
  visibility  Visibility @default(PRIVATE)
  isDraft     Boolean    @default(false)
  userId      String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  posts       Post[]     @relation("PostsInCollections")

  @@index([userId])
}

model Image {
  id          String   @id @default(cuid())
  url         String
  description String?
  postId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  post        Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  postId    String
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([postId])
}

model Like {
  id        String   @id @default(cuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@index([postId])
}

model Follow {
  id          String   @id @default(cuid())
  followerId  String
  followingId String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  follower    User     @relation("Follower", fields: [followerId], references: [id], onDelete: Cascade)
  following   User     @relation("Following", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

enum Category {
  FILMREFLECTION
  ARTICLE
  BOOKS
  MUSIC
  YOUTUBE
  DOCUMENTARY
  PODCAST
  OTHER
}

enum TAGS {
  INSPIRATIONAL
  MOTIVATIONAL
  FUNNY
  LOVE
  SEX
  ROMANCE
  RELATIONSHIP
  FRIENDSHIP
  COLLEGE
  WORK
  FAMILY
  LIFE
  SELFIMPROVEMENT
  SELFHELP
  SELFLOVE
  SELFCARE
  PHILOSOPHY
  PSYCHOLOGY
  SPIRITUALITY
  MENTALHEALTH
  PERSONALDEVELOPMENT
  PERSONALGROWTH
  PERSONALBRAND
  FILMOGRAPHY
  FILMMAKING
  CINEMATOGRAPHY
  SCREENWRITING
  DIRECTING
  ACTING
  PRODUCING
  EDITING
  MUSICPRODUCTION
  OTHER
}

enum Visibility {
  PUBLIC
  PRIVATE
  FOLLOWERS
}
